#### 一、线性代数回顾

##### 1.向量定义

- 大小方向
- 没有固定的起点，只代表起点与终点之间的相对位置关系。

 模长$||\vec{a}||$

单位向量$\hat{a}=\frac{\vec{a}}{||\vec{a}||}$

加法：

- 在几何上，三角形法则：**将被加向量尾与加向量头部相连**
- 在代数上，直接加上坐标

**默认所有向量都是列向量。**

##### 2.向量运算

###### 1.点乘：

- 几何上$\vec{a}\cdot\vec{b}=||\vec{a}||||\vec{b}||\cos{\theta}$。对于单位向量，模长为1，所以点乘值即其夹角的余弦。**点乘结果是数，已知向量的代数表示即可立刻得到其夹角。**
- 满足交换、结合、分配律
- 代数上，$\vec{a}\cdot\vec{b}=\pmatrix{x_a\\x_b}\cdot\pmatrix{y_a\\y_b}$。以此类推，高维向量点乘也是对应相乘再相加。

- 投影：将向量b投影到a上，得到一个新的向量：

![1-1](./images/1-1.png)

- 即：$\vec{b}_{\perp}=\vec{b}\cos{\theta}$
  - $\vec{b}_{\perp}$是与a共线的向量，所以必然有$\vec{b}_{\perp}=k\hat{a}$（单位向量）
  - 对上式子两边取模长，k就是$\vec{b}_{\perp}$的模长。而根据三角关系，$||\vec{b}_{\perp}||=||\vec{b}||\cos{\theta}$
    - 共线、求出了长度关系，则可以去掉模长符号。
- 好处：
  - 可以将一个向量分解为两个互相垂直的向量：例如上图中可以分解得到$\vec{b}_{\perp}、\vec{b}-\vec{b}_{\perp}$两个向量。
  - 可以通过计算点乘得到两个向量的相近程度。（Transformer的核心）。如果点乘结果小于0说明它们之间大于90度；大于0就小于90度。

###### 2.叉乘

- 算法：**右手定则**，四指指向左乘向量的方向，此时如果四指往掌心并拢的方向能够转向右乘向量的方向，则大拇指即结果的方向。

- 规则：

  - $\vec{a} \times\vec{b} = -\vec{b}\times\vec{a}$
  - $||\vec{a} \times\vec{b}|| = ||\vec{a}||||\vec{b}||\sin{\theta}$
  - 满足分配律，交换要加负号；不满足结合律。
  - 自己与自己叉乘得到垂直的0**向量**，

- 用处：

  - 三维空间里面确定坐标系。已知x和y轴将其叉乘即得到z轴。**按照上述情况得到的z轴组成的坐标系就叫做右手坐标系，课程默认都是右手坐标系。**(高数课的坐标系就是这样画的)

  - 判断一个向量与另一个向量的相对位置（在左还是在右）。如果叉乘结果是正的（右手拇指向上），则说明被考查向量在基准向量的左边（基准向量逆时针旋转后到达被考察向量）；反之在右边（顺时针）。

  - **判断一个点是否在一个封闭图形内部**：

    ![1-2](./images/1-2.png)

​	将图形用向量按同一方向包围，依次作顶点与待求点的向量，再用边组成的向量分别与作出的向量求叉乘。如果所有边的叉乘结果都同号，则说明这个点在图形内部，否则至少有一个反号就在外面。直观地说，就是P点一直在三条边的左边/右边。

​	如果叉乘得到了0？边界情况，由用户自己决定。

##### 3.坐标系的定义：

任意三个向量如果满足：

$\begin{cases}||\vec{u}||=||\vec{v}||=||\vec{w}||=1 \\ \vec{u}\cdot\vec{v}=\vec{u}\cdot\vec{w}=\vec{v}\cdot\vec{w}=0 \\ \vec{w}=\vec{u}\times\vec{v}\end{cases}$

则可以构成一个坐标系，坐标系中任意向量$\vec{p}=(\vec{p}\cdot{\vec{u}})\vec{u}+(\vec{p}\cdot{\vec{v}})\vec{v}+(\vec{p}\cdot{\vec{w}})\vec{w}$.

其中$(\vec{p}\cdot{\vec{u}})\vec{u}$的系数就是p在u上的投影，但是u是单位向量，所以实质就是p在u上的长度，再乘以单位向量u化为向量。这样就把p分解为向量之和。



##### 3.矩阵

###### 1.矩阵乘法

$A_{m\times n}B_{n\times l}=C_{m\times l}$；

C矩阵**第i行第j列的元素**，**即A矩阵第i行的行向量**与**B矩阵第j行的列向量**==点乘==的结果。

性质

- 满足结合律、分配律
- **不满足交换律**

###### 2.转置、逆矩阵、单位矩阵

还记得吧？

- $(AB)^T=B^TA^T$
- $(AB)^{-1}=B^{-1}A^{-1}$
- $AA^{-1}=E$或者写成$AA^{-1}=I$

其他应用：

- $\vec{a}\cdot\vec{b}=\vec{a}^T\vec{b}$（右边是矩阵相乘）
- $\vec{a}\cdot\vec{b}=A^*\vec{b}=\pmatrix{0&-a_3&a_2\\a_3&0&-a_1\\-a_2&a_1&0}\pmatrix{b_1\\b_2\\b_3}$。这个A称作a向量的对偶矩阵。



#### 二、变换

##### 1.二维变换

求解变换矩阵的核心是找到旋转后坐标与之前坐标的等式关系。**由于每一个点都应该满足这样一个等式，所以只要求得一个点的等式关系，并且这个等式不含有以x y x' y'以及已知图形参数和变换距离和角度之外的数，则这个点的等式关系也就是整个图的等式关系。**这样可以用某些特殊点去求得整个图的变化。

变换矩阵推导方法示例见第4.节旋转。

###### 1.缩放(scale)

- 均匀缩放：设原来图像中任一点坐标是(x,y)，则变换后可以记作x'=sx、y'=sy。写作矩阵形式也可以是：$\pmatrix{x'\\y'}=\pmatrix{s&0\\0&s}\pmatrix{x\\y}$.在这里右侧左乘的矩阵就叫做缩放矩阵。

- 不均匀缩放：同上，但是主对角线的s可以取不同值：$\pmatrix{x'\\y'}=\pmatrix{s_x&0\\0&s_y}\pmatrix{x\\y}$

###### 2.反射（reflection)

将图像关于某坐标轴对称。自然，关于x轴对称把y全部取反，即$s_x=1,s_y=-1$；关于y轴对称把x全部取反即可，即$s_x=-1,s_y=1$.

###### 3.切变（shear)

![2-1](./images/2-1.png)

上图是一个边长为1的正方形，将其切变。

由于所有y=1处的点都移动了1，设所有x=0处的点移动**后**坐标变为$(t_x,t_y)$，那么由相似三角形就有$\frac{t_y}{1}=\frac{t_x}{a}$，得到$t_x=at_y$。

而这些点移动前x=0，所以水平方向就**移动了**tx-0=aty；竖直方向没有移动，移动前后y不变；又由于同一y上所有点的水平移动距离相同，所以那些x不等于0处的点也移动了aty（这个ty对于同一水平线上的点都相同，所以可以用x=0处点的ty来代入）。

则变换前后y'=y, x'=x+ay，写作矩阵即：$\pmatrix{x'\\y'}=\pmatrix{1&a\\0&1}\pmatrix{x\\y}$。注意$at_y$是移动的距离哦！

如果是沿着y方向做切变，那x=1保持不变，y往上移动a，于是变换矩阵变成下三角即可。

###### 4.旋转

默认情况下，只说旋转则是将图形绕着原点、逆时针旋转。

![2-2](./images/2-2.png)

上图仍然是一个边长为1的正方形，结果显然。如果边长为a，那么旋转后右下角顶点的坐标应该是$(a\cos\theta,a\sin\theta)$；左上角的sinθ由于本身仍正但是点在第二象限，所以取了负号。

![2-3](./images/2-3.png)

上图展示了如何进行变换矩阵的推导。

- 由于变换矩阵的对于所有点的变换都适用，只需要用有限个特例即可求得变换矩阵的所有参数，并且它一定是正确的变换矩阵。
- 所以在这个例子里，可以设矩阵的四个数分别是ABCD，然后取两个点如(1,0)和(0,1)，找到变换前后的关系，代入这个方程组求解ABCD即可。
- 得到的结果为：$\bold R=\pmatrix{\cos\theta&-\sin\theta\\\sin\theta& \cos\theta}$



**以上变换都是线性变换，这意味着：**

- 线性变换保持直线为直线。

- 平行线仍然平行。
- 原点保持不动。

- 图形可能被旋转、拉伸、反射或扭曲（切变），但不会弯曲。

平移引入了加法，会导致原点发生改变，不属于线性变换。那么有没有方法可以使得平移也变成线性变换？



##### 2.齐次坐标（Homogenous coordinate)

为了统一平移运算到线性变换中，**为二维点额外加上一个维度坐标，默认为1；为二维向量额外加上一个维度坐标，默认为0**。
